<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Toddler Flashcards ‚Äì PWA</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#5b8ef9">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<link rel="apple-touch-icon" href="assets/icon-192.png">
<style>
body {
  font-family: "Comic Sans MS", "Fredoka One", sans-serif;
  background: #f0f9ff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  margin: 0;
  padding: 0;
  min-height: 100vh;
}

header {
  width: 100%;
  padding: 5px 10px;
  box-sizing: border-box;
}

header .row {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  gap: 5px;
}

header .title {
  font-size: 1.3rem;
  flex: 1 1 auto;
  text-align: center;
  min-width: 120px;
}

header .seg {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  justify-content: center;
  flex: 2 1 auto;
}

header .seg button {
  font-size: 0.9rem;
  padding: 5px 8px;
  min-width: 45px;
}

header button#muteBtn {
  font-size: 1.2rem;
  padding: 5px 10px;
}

.stage {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
  width: 100%;
  max-width: 600px;
}

.card-wrap {
  width: 90vw;
  max-width: 500px;
  height: 60vh;
  max-height: 500px;
  position: relative;
  margin: 10px 0;
}

.card {
  width: 100%;
  height: 100%;
  border-radius: 25px;
  box-shadow: 0 8px 16px rgba(0,0,0,0.2);
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: calc(6rem + 2vw);
  font-weight: bold;
  color: #333;
  transition: transform 0.4s ease, background 0.3s ease;
  cursor: pointer;
  position: relative;
}

.card.flipped .front { display: none; }
.card.flipped .back { display: flex; }

.face.front, .face.back {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 25px;
  display: flex;
  justify-content: center;
  align-items: center;
  backface-visibility: hidden;
  transition: transform 0.4s;
}

.face.back { display: none; background: #fff; }

.controls {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 5px;
  margin-bottom: 10px;
}

.controls button {
  font-size: 1.5rem;
  width: 60px;
  height: 60px;
  padding: 5px;
}

button:active { background: #0077cc; }

.big-text { font-size: calc(4rem + 2vw); text-align: center; padding: 0 10px; }

footer {
  font-size: 0.8rem;
  padding: 5px;
  text-align: center;
}

@media (max-width: 400px) {
  header .title { font-size: 1rem; }
  header .seg button { font-size: 0.7rem; padding: 3px 5px; min-width: 35px; }
  header button#muteBtn { font-size: 1rem; padding: 3px 5px; }
  .controls button { font-size: 1.2rem; width: 50px; height: 50px; }
  .big-text { font-size: 3rem; }
}
</style>
</head>
<body>
<header>
  <div class="row">
    <div class="title" id="appTitle">Flashcards: Colors</div>
    <div class="seg" role="group">
      <button data-mode="colors" aria-pressed="true">üé®</button>
      <button data-mode="letters" aria-pressed="false">üî§</button>
      <button data-mode="numbers" aria-pressed="false">üî¢</button>
      <button data-mode="shapes" aria-pressed="false">‚¨õ</button>
      <button data-mode="favorites" aria-pressed="false">‚≠ê</button>
    </div>
    <button id="muteBtn" aria-pressed="false" title="Toggle sound">üîä</button>
  </div>
</header>
<main>
  <div class="stage">
    <div class="card-wrap" id="cardWrap" tabindex="0" aria-live="polite">
      <div class="card" id="card">
        <div class="face front" id="front"></div>
        <div class="face back" id="back"></div>
      </div>
    </div>
    <div class="controls">
      <button id="prevBtn">‚üµ</button>
      <button id="flipBtn">üîÑ</button>
      <button id="nextBtn">‚ü∂</button>
      <button id="shuffleBtn">üîÄ</button>
      <button id="autoplayBtn">‚ñ∂Ô∏è</button>
      <button id="fullscreenBtn">‚õ∂</button>
    </div>
  </div>
</main>
<footer>Tap the card to flip. Swipe or use buttons. Add to Home Screen via Safari.</footer>

<script>
// Register Service Worker
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('./service-worker.js');
  });
}

(function(){
  const COLORS=[{name:"Red",hex:"#ff3b30"},{name:"Blue",hex:"#007aff"},{name:"Yellow",hex:"#ffcc00"},{name:"Green",hex:"#34c759"},{name:"Orange",hex:"#ff9500"},{name:"Purple",hex:"#af52de"},{name:"Pink",hex:"#ff2d55"},{name:"Brown",hex:"#8b5e3c"},{name:"Black",hex:"#000000"},{name:"White",hex:"#ffffff"}];
  const LETTERS=[{letter:"A",word:"Apple"},{letter:"B",word:"Bear"},{letter:"C",word:"Cat"},{letter:"D",word:"Dog"},{letter:"E",word:"Egg"},{letter:"F",word:"Frog"},{letter:"G",word:"Grapes"},{letter:"H",word:"House"},{letter:"I",word:"Ice cream"},{letter:"J",word:"Juice"},{letter:"K",word:"Kite"},{letter:"L",word:"Lion"},{letter:"M",word:"Moon"},{letter:"N",word:"Nose"},{letter:"O",word:"Orange"},{letter:"P",word:"Pig"},{letter:"Q",word:"Queen"},{letter:"R",word:"Rainbow"},{letter:"S",word:"Sun"},{letter:"T",word:"Turtle"},{letter:"U",word:"Umbrella"},{letter:"V",word:"Violin"},{letter:"W",word:"Whale"},{letter:"X",word:"Xylophone"},{letter:"Y",word:"Yarn"},{letter:"Z",word:"Zebra"}];
  const NUMBERS=[{num:"1",word:"One"},{num:"2",word:"Two"},{num:"3",word:"Three"},{num:"4",word:"Four"},{num:"5",word:"Five"},{num:"6",word:"Six"},{num:"7",word:"Seven"},{num:"8",word:"Eight"},{num:"9",word:"Nine"},{num:"10",word:"Ten"}];
  const SHAPES=[{shape:"Circle"},{shape:"Square"},{shape:"Triangle"},{shape:"Star"},{shape:"Heart"},{shape:"Oval"},{shape:"Diamond"},{shape:"Rectangle"}];
  const FAVORITES=[{name:"Dog"},{name:"Cat"},{name:"Fire Truck"},{name:"Airplane"},{name:"Tractor"},{name:"Elephant"},{name:"Dinosaur"},{name:"Teddy Bear"}];

  let mode=localStorage.getItem("mode")||"colors";
  let index=0; let flipped=false; let autoplay=null; let muted=(localStorage.getItem("muted")==="true");

  const appTitle=document.getElementById("appTitle");
  const front=document.getElementById("front"), back=document.getElementById("back"), card=document.getElementById("card");
  const cardWrap=document.getElementById("cardWrap");
  const prevBtn=document.getElementById("prevBtn"), nextBtn=document.getElementById("nextBtn"),
        flipBtn=document.getElementById("flipBtn"), shuffleBtn=document.getElementById("shuffleBtn"),
        autoplayBtn=document.getElementById("autoplayBtn"), fullscreenBtn=document.getElementById("fullscreenBtn"),
        muteBtn=document.getElementById("muteBtn");
  const segBtns=document.querySelectorAll(".seg button");

  function deck(){
    return mode==="colors"?COLORS:mode==="letters"?LETTERS:mode==="numbers"?NUMBERS:mode==="shapes"?SHAPES:FAVORITES;
  }

  function speak(txt){
    if(muted) return;
    if(!("speechSynthesis" in window)) return;
    try{
      let u=new SpeechSynthesisUtterance(txt);
      u.rate=0.7;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(u);
    }catch(e){}
  }

  function render(){
    const d=deck(); 
    if(index<0) index=d.length-1;
    if(index>=d.length) index=0;
    const item=d[index];
    card.classList.toggle("flipped", flipped);

    if(mode==="colors"){
      front.style.background = item.hex;
      front.innerHTML="";
      back.style.background = "#fff";
      back.innerHTML=`<div class="big-text">${item.name}</div>`;
    } else if(mode==="letters"){
      front.style.background="#fff";
      front.innerHTML=`<div class="big-text">${item.letter}</div>`;
      back.style.background="#fff";
      back.innerHTML=`<div class="big-text">${item.word}</div>`;
    } else if(mode==="numbers"){
      front.style.background="#fff";
      front.innerHTML=`<div class="big-text">${item.num}</div>`;
      back.style.background="#fff";
      back.innerHTML=`<div class="big-text">${item.word}</div>`;
    } else if(mode==="shapes"){
      front.style.background="#fff";
      front.innerHTML=`<div class="big-text">${item.shape}</div>`;
      back.style.background="#fff";
      back.innerHTML=`<div class="big-text">${item.shape}</div>`;
    } else if(mode==="favorites"){
      front.style.background="#fff";
      front.innerHTML=`<div class="big-text">${item.name}</div>`;
      back.style.background="#fff";
      back.innerHTML=`<div class="big-text">${item.name}</div>`;
    }

    if(flipped){
      if(mode==="colors"){ speak(item.name); }
      else if(mode==="letters"){ speak(`${item.letter} is for ${item.word}`); }
      else if(mode==="numbers"){ speak(item.word); }
      else if(mode==="shapes"){ speak(item.shape); }
      else